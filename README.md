# openwsn-data: objective

This repository helps to analyse the data produced by openwsn-fw (https://github.com/ftheoleyre/openwsn-fw/tree/CCA) and openvisualizer (https://github.com/ftheoleyre/openvisualizer).



# Installation

The scripts support Python3. More precisely, you can install the dependencies with conda:

`conda env create -f openwsn-data.yml`

# Preprocessing

First you have to prepare the sqlite db files produced by openvisualizer with the following command:

`python3 convert_db_in_json.py --dir XXX`

XXX is the directory that contains the experiment (one experiment per subdirectory, whatever the name is).

It works as following

1. it merges all the sqlite individual databases in a single one `openv_events.db`
1. it processes all the layer 2 transmissions (per link) to identify CCA, SFD, hidden receivers, etc.
1. it processes all the cexample packets (per cexample packet generated by a source). For each packet, it keeps a record of the actions all along the path (tx, asn, etc.)
1. for each experiment, it extracts all the metadata (nb of nodes, etc.)
1. everything is finally stored in a json file `stats.json`

By default, the script doesn't re-process the pre-processed directory (with an existing `stats.json` file). We can force the reprocessing with the option: `--rewrite`


# Scenarios

The data pipeline has been designed to procude statistics for two different scenarios:

* fault-tolerance: one of the nodes is turned-off, and the reliability and delay metrics are plotted (x-cordinate = time);
* sclability: a large collection of experiments is runned, with different number of nodes. Different metrics (reliability, delay, nb of transmissions, etc.) are then plotted (x-coordinate = # nodes). 

The directory that contains the raw results of the experiments MUST be pre-processed before extracting data:

`python plot_faultolerance.py --dir XXX`



## Fault Tolerance scenario


The script:

* extracts the delay of reception of each cexample packet for two scenarios (with and without CCA). 
* plots two different figures to represent the distribution of the delay according to the experiment time.


## Scalability scenario

The script plots:

* the PDR, delay and number of layer 2 transmissions for each group of exepriments with the same number of nodes
* for each radio link the ratio of time the CCA is negative, how many start of frames interrupts are triggered, etc.
 
 
On stdout are also printed individual statistics (for debuging mainly):

* for each cexample source, the perf metrics (PDR, delay, etc.)
* fo each link, the ratio of positive CCA, SFD, etc.
